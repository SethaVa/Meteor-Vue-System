{"metadata":{},"options":{"plugins":[{"key":"/Users/rabbit/Desktop/app/bad-system/node_modules/babel-plugin-transform-vue-jsx/index.js","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/rabbit/Desktop/app/bad-system/imports/modules/school/client/pages/StudentForm.vue","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","jsx","dynamicImport",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"/Users/rabbit/Desktop/app/bad-system/imports/modules/school/client/pages/StudentForm.vue","filename":"/Users/rabbit/Desktop/app/bad-system/imports/modules/school/client/pages/StudentForm.vue","passPerPreset":false,"envName":"development","cwd":"/Users/rabbit/Desktop/app/bad-system","root":"/Users/rabbit/Desktop/app/bad-system","generatorOpts":{"filename":"/Users/rabbit/Desktop/app/bad-system/imports/modules/school/client/pages/StudentForm.vue","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"/Users/rabbit/Desktop/app/bad-system/imports/modules/school/client/pages/StudentForm.vue"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nvar moment;\nmodule.link(\"moment\", {\n  \"default\": function (v) {\n    moment = v;\n  }\n}, 0);\nvar Msg;\nmodule.link(\"/imports/client/lib/message\", {\n  \"default\": function (v) {\n    Msg = v;\n  }\n}, 1);\nvar Notify;\nmodule.link(\"/imports/client/lib/notify\", {\n  \"default\": function (v) {\n    Notify = v;\n  }\n}, 2);\nvar wrapCurrentTime;\nmodule.link(\"/imports/client/lib/wrap-current-time\", {\n  \"default\": function (v) {\n    wrapCurrentTime = v;\n  }\n}, 3);\nvar lookupValue;\nmodule.link(\"/imports/client/lib/Lookup-Value\", {\n  \"default\": function (v) {\n    lookupValue = v;\n  }\n}, 4);\n\nvar _;\n\nmodule.link(\"lodash\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 5);\nvar insertStudent, findOneStudent, updateStudent;\nmodule.link(\"/imports/modules/school/api/students/methods.js\", {\n  insertStudent: function (v) {\n    insertStudent = v;\n  },\n  findOneStudent: function (v) {\n    findOneStudent = v;\n  },\n  updateStudent: function (v) {\n    updateStudent = v;\n  }\n}, 6);\nvar mapState;\nmodule.link(\"vuex\", {\n  mapState: function (v) {\n    mapState = v;\n  }\n}, 7);\nvar getNextRef;\nmodule.link(\"/imports/utils/get-next-ref.js\", {\n  getNextRef: function (v) {\n    getNextRef = v;\n  }\n}, 8);\nmodule.exportDefault({\n  name: 'StudentForm',\n  props: {\n    updateId: {\n      type: String,\n      \"default\": null\n    },\n    visible: {\n      type: Boolean,\n      \"default\": false\n    }\n  },\n  data: function () {\n    var _this = this;\n\n    // Check Code\n    var validateCode = function (rule, value, callback) {\n      if (!value) {\n        return callback(new Error('Code is requiered'));\n      }\n\n      setTimeout(function () {\n        var selector = {\n          code: value,\n          branchId: _this.currentBranchId\n        };\n\n        if (_this.updateId) {\n          selector._id = {\n            $ne: _this.updateId\n          };\n        }\n\n        findOneStudent.callPromise({\n          selector: selector\n        }).then(function (result) {\n          if (result) {\n            callback(new Error('This code is existed'));\n          } else {\n            callback();\n          }\n        }).catch(function (error) {\n          Notify.error({\n            message: error\n          });\n        });\n      }, 1000);\n    };\n\n    return {\n      // loading\n      loading: {\n        form: false,\n        code: ''\n      },\n      // opts\n      genderOpts: lookupValue.gender,\n      typeOpts: lookupValue.type,\n      //form\n      form: {\n        registerDate: moment().toDate(),\n        code: '',\n        type: '',\n        khName: '',\n        enName: '',\n        gender: '',\n        dob: '',\n        tel: '',\n        remove: false\n      },\n      // rules\n      rules: {\n        registerDate: [{\n          required: true,\n          message: 'Date is required',\n          trigger: 'change'\n        }],\n        code: [{\n          validator: validateCode,\n          required: true,\n          trigger: 'change'\n        }],\n        khName: [{\n          required: true,\n          message: 'Please Input Khmrt Name',\n          trigger: 'blur'\n        }],\n        enName: [{\n          required: true,\n          message: 'Please Input English Name',\n          trigger: 'blur'\n        }],\n        gender: [{\n          required: true,\n          message: 'Please Select Gender',\n          trigger: 'blur'\n        }],\n        type: [{\n          required: true,\n          message: 'Please Select Type',\n          trigger: 'blur'\n        }],\n        dob: [{\n          required: true,\n          message: 'Date of birth is required!',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  computed: (0, _objectSpread2.default)({}, mapState({\n    currentBranchId: function (state) {\n      return state.app && state.app.currentBranch._id;\n    }\n  }), {\n    dateFormat: function () {\n      return this.$store.getters['app/dateFormat'];\n    }\n  }),\n  created: function () {\n    if (!this.updateId) this._getNextRefNum();\n  },\n  mounted: function () {\n    if (this.updateId) this._getOneStudentData();\n  },\n  methods: {\n    _getNextRefNum: function () {\n      var _this2 = this;\n\n      this.loading.code = 'Loading....'; // getNextRef\n\n      getNextRef.callPromise({\n        collectionName: 'sch_students',\n        opts: {\n          field: 'code',\n          selector: {\n            branchId: this.currentBranchId\n          },\n          paddingType: 'start',\n          paddingLength: 5,\n          paddingChar: '0' // prefix: {},\n\n        }\n      }).then(function (result) {\n        if (result) {\n          _this2.loading.code = '';\n          _this2.form.code = result;\n        }\n      }).catch(function (error) {\n        _this2.loading.code = '';\n        Notify.error({\n          message: error\n        });\n      });\n    },\n    // Get data for update\n    _getOneStudentData: function () {\n      var _this3 = this;\n\n      this.loading.form = true;\n      findOneStudent.callPromise({\n        selector: {\n          _id: this.updateId,\n          branchId: this.currentBranchId\n        }\n      }).then(function (result) {\n        _this3.form = result;\n        _this3.loading.form = false;\n      }).catch(function (error) {\n        _this3.loading.form = false;\n        Notify.error({\n          message: error\n        });\n      });\n    },\n\n    /**\n     * Submit form\n     */\n    _submitForm: function () {\n      var _this4 = this;\n\n      this.loading.form = true;\n      this.$refs['form'].validate(function (valid) {\n        if (valid) {\n          _this4.form.dob = wrapCurrentTime(_this4.form.dob);\n          _this4.form.registerDate = wrapCurrentTime(_this4.form.registerDate);\n          _this4.form.branchId = _this4.currentBranchId; // console.log(this.form)\n\n          if (_this4.updateId) {\n            // Update data\n            updateStudent.callPromise({\n              doc: _this4.form\n            }).then(function (result) {\n              if (result) {\n                _this4.loading.form = false;\n\n                _this4.handleClose();\n\n                Msg.success();\n              }\n            }).catch(function (error) {\n              _this4.loading.form = false;\n              Notify.error({\n                message: error\n              });\n            });\n          } else {\n            // Insert data\n            insertStudent.callPromise({\n              doc: _this4.form\n            }).then(function (result) {\n              if (result) {\n                _this4.loading.form = false;\n\n                _this4.handelresetForm();\n\n                Msg.success();\n              }\n            }).catch(function (error) {\n              _this4.loading.form = false;\n              Notify.error({\n                message: error\n              });\n            });\n          }\n        } else {\n          _this4.loading.form = false;\n          return false;\n        }\n      });\n    },\n    handleClose: function () {\n      this.$emit('modal-close');\n    },\n    handelresetForm: function () {\n      this.$refs['form'].resetFields();\n    }\n  }\n});","map":{"version":3,"sources":["/Users/rabbit/Desktop/app/bad-system/imports/modules/school/client/pages/StudentForm.vue"],"names":["moment","module","link","v","Msg","Notify","wrapCurrentTime","lookupValue","_","insertStudent","findOneStudent","updateStudent","mapState","getNextRef","exportDefault","name","props","updateId","type","String","visible","Boolean","data","validateCode","rule","value","callback","Error","setTimeout","selector","code","branchId","currentBranchId","_id","$ne","callPromise","then","result","catch","error","message","loading","form","genderOpts","gender","typeOpts","registerDate","toDate","khName","enName","dob","tel","remove","rules","required","trigger","validator","computed","state","app","currentBranch","dateFormat","$store","getters","created","_getNextRefNum","mounted","_getOneStudentData","methods","collectionName","opts","field","paddingType","paddingLength","paddingChar","_submitForm","$refs","validate","valid","doc","handleClose","success","handelresetForm","$emit","resetFields"],"mappings":";;;;AAAA,IAAIA,MAAJ;AAAWC,MAAM,CAACC,IAAP,CAAY,QAAZ,EAAqB;AAAA,uBAASC,CAAT,EAAW;AAACH,IAAAA,MAAM,GAACG,CAAP;AAAS;AAArB,CAArB,EAA4C,CAA5C;AAA+C,IAAIC,GAAJ;AAAQH,MAAM,CAACC,IAAP,CAAY,6BAAZ,EAA0C;AAAA,uBAASC,CAAT,EAAW;AAACC,IAAAA,GAAG,GAACD,CAAJ;AAAM;AAAlB,CAA1C,EAA8D,CAA9D;AAAiE,IAAIE,MAAJ;AAAWJ,MAAM,CAACC,IAAP,CAAY,4BAAZ,EAAyC;AAAA,uBAASC,CAAT,EAAW;AAACE,IAAAA,MAAM,GAACF,CAAP;AAAS;AAArB,CAAzC,EAAgE,CAAhE;AAAmE,IAAIG,eAAJ;AAAoBL,MAAM,CAACC,IAAP,CAAY,uCAAZ,EAAoD;AAAA,uBAASC,CAAT,EAAW;AAACG,IAAAA,eAAe,GAACH,CAAhB;AAAkB;AAA9B,CAApD,EAAoF,CAApF;AAAuF,IAAII,WAAJ;AAAgBN,MAAM,CAACC,IAAP,CAAY,kCAAZ,EAA+C;AAAA,uBAASC,CAAT,EAAW;AAACI,IAAAA,WAAW,GAACJ,CAAZ;AAAc;AAA1B,CAA/C,EAA2E,CAA3E;;AAA8E,IAAIK,CAAJ;;AAAMP,MAAM,CAACC,IAAP,CAAY,QAAZ,EAAqB;AAAA,uBAASC,CAAT,EAAW;AAACK,IAAAA,CAAC,GAACL,CAAF;AAAI;AAAhB,CAArB,EAAuC,CAAvC;AAA0C,IAAIM,aAAJ,EAAkBC,cAAlB,EAAiCC,aAAjC;AAA+CV,MAAM,CAACC,IAAP,CAAY,iDAAZ,EAA8D;AAACO,EAAAA,aAAD,YAAeN,CAAf,EAAiB;AAACM,IAAAA,aAAa,GAACN,CAAd;AAAgB,GAAlC;AAAmCO,EAAAA,cAAnC,YAAkDP,CAAlD,EAAoD;AAACO,IAAAA,cAAc,GAACP,CAAf;AAAiB,GAAtE;AAAuEQ,EAAAA,aAAvE,YAAqFR,CAArF,EAAuF;AAACQ,IAAAA,aAAa,GAACR,CAAd;AAAgB;AAAxG,CAA9D,EAAwK,CAAxK;AAA2K,IAAIS,QAAJ;AAAaX,MAAM,CAACC,IAAP,CAAY,MAAZ,EAAmB;AAACU,EAAAA,QAAD,YAAUT,CAAV,EAAY;AAACS,IAAAA,QAAQ,GAACT,CAAT;AAAW;AAAxB,CAAnB,EAA6C,CAA7C;AAAgD,IAAIU,UAAJ;AAAeZ,MAAM,CAACC,IAAP,CAAY,gCAAZ,EAA6C;AAACW,EAAAA,UAAD,YAAYV,CAAZ,EAAc;AAACU,IAAAA,UAAU,GAACV,CAAX;AAAa;AAA5B,CAA7C,EAA2E,CAA3E;AAAhvBF,MAAM,CAACa,aAAP,CA6Ge;AACbC,EAAAA,IAAI,EAAE,aADO;AAEbC,EAAAA,KAAK,EAAE;AACLC,IAAAA,QAAQ,EAAE;AACRC,MAAAA,IAAI,EAAEC,MADE;AAER,iBAAS;AAFD,KADL;AAKLC,IAAAA,OAAO,EAAE;AACPF,MAAAA,IAAI,EAAEG,OADC;AAEP,iBAAS;AAFF;AALJ,GAFM;AAYbC,EAAAA,IAZa,cAYN;AAAA;;AACL;AACA,QAAMC,YAAY,GAAG,UAACC,IAAD,EAAOC,KAAP,EAAcC,QAAd,EAA2B;AAC9C,UAAI,CAACD,KAAL,EAAY;AACV,eAAOC,QAAQ,CAAC,IAAIC,KAAJ,CAAU,mBAAV,CAAD,CAAf;AACD;;AACDC,MAAAA,UAAU,CAAC,YAAM;AACf,YAAIC,QAAQ,GAAG;AACbC,UAAAA,IAAI,EAAEL,KADO;AAEbM,UAAAA,QAAQ,EAAE,KAAI,CAACC;AAFF,SAAf;;AAKA,YAAI,KAAI,CAACf,QAAT,EAAmB;AACjBY,UAAAA,QAAQ,CAACI,GAAT,GAAe;AAAEC,YAAAA,GAAG,EAAE,KAAI,CAACjB;AAAZ,WAAf;AACD;;AAEDP,QAAAA,cAAc,CACXyB,WADH,CACe;AAAEN,UAAAA,QAAQ,EAARA;AAAF,SADf,EAEGO,IAFH,CAEQ,UAAAC,MAAM,EAAI;AACd,cAAIA,MAAJ,EAAY;AACVX,YAAAA,QAAQ,CAAC,IAAIC,KAAJ,CAAU,sBAAV,CAAD,CAAR;AACD,WAFD,MAEO;AACLD,YAAAA,QAAQ;AACT;AACF,SARH,EASGY,KATH,CASS,UAAAC,KAAK,EAAI;AACdlC,UAAAA,MAAM,CAACkC,KAAP,CAAa;AAAEC,YAAAA,OAAO,EAAED;AAAX,WAAb;AACD,SAXH;AAYD,OAtBS,EAsBP,IAtBO,CAAV;AAuBD,KA3BD;;AA6BA,WAAO;AACL;AACAE,MAAAA,OAAO,EAAE;AACPC,QAAAA,IAAI,EAAE,KADC;AAEPZ,QAAAA,IAAI,EAAE;AAFC,OAFJ;AAML;AACAa,MAAAA,UAAU,EAAEpC,WAAW,CAACqC,MAPnB;AAQLC,MAAAA,QAAQ,EAAEtC,WAAW,CAACW,IARjB;AASL;AACAwB,MAAAA,IAAI,EAAE;AACJI,QAAAA,YAAY,EAAE9C,MAAM,GAAG+C,MAAT,EADV;AAEJjB,QAAAA,IAAI,EAAE,EAFF;AAGJZ,QAAAA,IAAI,EAAE,EAHF;AAIJ8B,QAAAA,MAAM,EAAE,EAJJ;AAKJC,QAAAA,MAAM,EAAE,EALJ;AAMJL,QAAAA,MAAM,EAAE,EANJ;AAOJM,QAAAA,GAAG,EAAE,EAPD;AAQJC,QAAAA,GAAG,EAAE,EARD;AASJC,QAAAA,MAAM,EAAE;AATJ,OAVD;AAqBL;AACAC,MAAAA,KAAK,EAAE;AACLP,QAAAA,YAAY,EAAE,CACZ;AAAEQ,UAAAA,QAAQ,EAAE,IAAZ;AAAkBd,UAAAA,OAAO,EAAE,kBAA3B;AAA+Ce,UAAAA,OAAO,EAAE;AAAxD,SADY,CADT;AAILzB,QAAAA,IAAI,EAAE,CAAC;AAAE0B,UAAAA,SAAS,EAAEjC,YAAb;AAA2B+B,UAAAA,QAAQ,EAAE,IAArC;AAA2CC,UAAAA,OAAO,EAAE;AAApD,SAAD,CAJD;AAKLP,QAAAA,MAAM,EAAE,CACN;AACEM,UAAAA,QAAQ,EAAE,IADZ;AAEEd,UAAAA,OAAO,EAAE,yBAFX;AAGEe,UAAAA,OAAO,EAAE;AAHX,SADM,CALH;AAYLN,QAAAA,MAAM,EAAE,CACN;AACEK,UAAAA,QAAQ,EAAE,IADZ;AAEEd,UAAAA,OAAO,EAAE,2BAFX;AAGEe,UAAAA,OAAO,EAAE;AAHX,SADM,CAZH;AAmBLX,QAAAA,MAAM,EAAE,CACN;AAAEU,UAAAA,QAAQ,EAAE,IAAZ;AAAkBd,UAAAA,OAAO,EAAE,sBAA3B;AAAmDe,UAAAA,OAAO,EAAE;AAA5D,SADM,CAnBH;AAsBLrC,QAAAA,IAAI,EAAE,CACJ;AAAEoC,UAAAA,QAAQ,EAAE,IAAZ;AAAkBd,UAAAA,OAAO,EAAE,oBAA3B;AAAiDe,UAAAA,OAAO,EAAE;AAA1D,SADI,CAtBD;AAyBLL,QAAAA,GAAG,EAAE,CACH;AACEI,UAAAA,QAAQ,EAAE,IADZ;AAEEd,UAAAA,OAAO,EAAE,4BAFX;AAGEe,UAAAA,OAAO,EAAE;AAHX,SADG;AAzBA;AAtBF,KAAP;AAwDD,GAnGY;AAoGbE,EAAAA,QAAQ,kCACH7C,QAAQ,CAAC;AACVoB,IAAAA,eADU,YACM0B,KADN,EACa;AACrB,aAAOA,KAAK,CAACC,GAAN,IAAaD,KAAK,CAACC,GAAN,CAAUC,aAAV,CAAwB3B,GAA5C;AACD;AAHS,GAAD,CADL;AAMN4B,IAAAA,UANM,cAMO;AACX,aAAO,KAAKC,MAAL,CAAYC,OAAZ,CAAoB,gBAApB,CAAP;AACD;AARK,IApGK;AA8GbC,EAAAA,OA9Ga,cA8GH;AACR,QAAI,CAAC,KAAK/C,QAAV,EAAoB,KAAKgD,cAAL;AACrB,GAhHY;AAiHbC,EAAAA,OAjHa,cAiHH;AACR,QAAI,KAAKjD,QAAT,EAAmB,KAAKkD,kBAAL;AACpB,GAnHY;AAoHbC,EAAAA,OAAO,EAAE;AACPH,IAAAA,cADO,cACU;AAAA;;AACf,WAAKxB,OAAL,CAAaX,IAAb,GAAoB,aAApB,CADe,CAEf;;AACAjB,MAAAA,UAAU,CACPsB,WADH,CACe;AACXkC,QAAAA,cAAc,EAAE,cADL;AAEXC,QAAAA,IAAI,EAAE;AACJC,UAAAA,KAAK,EAAE,MADH;AAEJ1C,UAAAA,QAAQ,EAAE;AAAEE,YAAAA,QAAQ,EAAE,KAAKC;AAAjB,WAFN;AAGJwC,UAAAA,WAAW,EAAE,OAHT;AAIJC,UAAAA,aAAa,EAAE,CAJX;AAKJC,UAAAA,WAAW,EAAE,GALT,CAMJ;;AANI;AAFK,OADf,EAYGtC,IAZH,CAYQ,UAAAC,MAAM,EAAI;AACd,YAAIA,MAAJ,EAAY;AACV,UAAA,MAAI,CAACI,OAAL,CAAaX,IAAb,GAAoB,EAApB;AACA,UAAA,MAAI,CAACY,IAAL,CAAUZ,IAAV,GAAiBO,MAAjB;AACD;AACF,OAjBH,EAkBGC,KAlBH,CAkBS,UAAAC,KAAK,EAAI;AACd,QAAA,MAAI,CAACE,OAAL,CAAaX,IAAb,GAAoB,EAApB;AACAzB,QAAAA,MAAM,CAACkC,KAAP,CAAa;AAAEC,UAAAA,OAAO,EAAED;AAAX,SAAb;AACD,OArBH;AAsBD,KA1BM;AA2BP;AACA4B,IAAAA,kBA5BO,cA4Bc;AAAA;;AACnB,WAAK1B,OAAL,CAAaC,IAAb,GAAoB,IAApB;AACAhC,MAAAA,cAAc,CACXyB,WADH,CACe;AACXN,QAAAA,QAAQ,EAAE;AAAEI,UAAAA,GAAG,EAAE,KAAKhB,QAAZ;AAAsBc,UAAAA,QAAQ,EAAE,KAAKC;AAArC;AADC,OADf,EAIGI,IAJH,CAIQ,UAAAC,MAAM,EAAI;AACd,QAAA,MAAI,CAACK,IAAL,GAAYL,MAAZ;AACA,QAAA,MAAI,CAACI,OAAL,CAAaC,IAAb,GAAoB,KAApB;AACD,OAPH,EAQGJ,KARH,CAQS,UAAAC,KAAK,EAAI;AACd,QAAA,MAAI,CAACE,OAAL,CAAaC,IAAb,GAAoB,KAApB;AACArC,QAAAA,MAAM,CAACkC,KAAP,CAAa;AAAEC,UAAAA,OAAO,EAAED;AAAX,SAAb;AACD,OAXH;AAYD,KA1CM;;AA2CP;;;AAGAoC,IAAAA,WA9CO,cA8CO;AAAA;;AACZ,WAAKlC,OAAL,CAAaC,IAAb,GAAoB,IAApB;AACA,WAAKkC,KAAL,CAAW,MAAX,EAAmBC,QAAnB,CAA4B,UAAAC,KAAK,EAAI;AACnC,YAAIA,KAAJ,EAAW;AACT,UAAA,MAAI,CAACpC,IAAL,CAAUQ,GAAV,GAAgB5C,eAAe,CAAC,MAAI,CAACoC,IAAL,CAAUQ,GAAX,CAA/B;AACA,UAAA,MAAI,CAACR,IAAL,CAAUI,YAAV,GAAyBxC,eAAe,CAAC,MAAI,CAACoC,IAAL,CAAUI,YAAX,CAAxC;AACA,UAAA,MAAI,CAACJ,IAAL,CAAUX,QAAV,GAAqB,MAAI,CAACC,eAA1B,CAHS,CAIT;;AACA,cAAI,MAAI,CAACf,QAAT,EAAmB;AACjB;AACAN,YAAAA,aAAa,CACVwB,WADH,CACe;AAAE4C,cAAAA,GAAG,EAAE,MAAI,CAACrC;AAAZ,aADf,EAEGN,IAFH,CAEQ,UAAAC,MAAM,EAAI;AACd,kBAAIA,MAAJ,EAAY;AACV,gBAAA,MAAI,CAACI,OAAL,CAAaC,IAAb,GAAoB,KAApB;;AACA,gBAAA,MAAI,CAACsC,WAAL;;AACA5E,gBAAAA,GAAG,CAAC6E,OAAJ;AACD;AACF,aARH,EASG3C,KATH,CASS,UAAAC,KAAK,EAAI;AACd,cAAA,MAAI,CAACE,OAAL,CAAaC,IAAb,GAAoB,KAApB;AACArC,cAAAA,MAAM,CAACkC,KAAP,CAAa;AAAEC,gBAAAA,OAAO,EAAED;AAAX,eAAb;AACD,aAZH;AAaD,WAfD,MAeO;AACL;AACA9B,YAAAA,aAAa,CACV0B,WADH,CACe;AAAE4C,cAAAA,GAAG,EAAE,MAAI,CAACrC;AAAZ,aADf,EAEGN,IAFH,CAEQ,UAAAC,MAAM,EAAI;AACd,kBAAIA,MAAJ,EAAY;AACV,gBAAA,MAAI,CAACI,OAAL,CAAaC,IAAb,GAAoB,KAApB;;AACA,gBAAA,MAAI,CAACwC,eAAL;;AACA9E,gBAAAA,GAAG,CAAC6E,OAAJ;AACD;AACF,aARH,EASG3C,KATH,CASS,UAAAC,KAAK,EAAI;AACd,cAAA,MAAI,CAACE,OAAL,CAAaC,IAAb,GAAoB,KAApB;AACArC,cAAAA,MAAM,CAACkC,KAAP,CAAa;AAAEC,gBAAAA,OAAO,EAAED;AAAX,eAAb;AACD,aAZH;AAaD;AACF,SApCD,MAoCO;AACL,UAAA,MAAI,CAACE,OAAL,CAAaC,IAAb,GAAoB,KAApB;AACA,iBAAO,KAAP;AACD;AACF,OAzCD;AA0CD,KA1FM;AA4FPsC,IAAAA,WA5FO,cA4FO;AACZ,WAAKG,KAAL,CAAW,aAAX;AACD,KA9FM;AA+FPD,IAAAA,eA/FO,cA+FW;AAChB,WAAKN,KAAL,CAAW,MAAX,EAAmBQ,WAAnB;AACD;AAjGM;AApHI,CA7Gf","sourcesContent":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport moment from 'moment'\nimport Msg from '/imports/client/lib/message'\nimport Notify from '/imports/client/lib/notify'\nimport wrapCurrentTime from '/imports/client/lib/wrap-current-time'\nimport lookupValue from '/imports/client/lib/Lookup-Value'\nimport _ from 'lodash'\n\nimport {\n  insertStudent,\n  findOneStudent,\n  updateStudent,\n} from '/imports/modules/school/api/students/methods.js'\n\nimport { mapState } from 'vuex'\n\nimport { getNextRef } from '/imports/utils/get-next-ref.js'\n\nexport default {\n  name: 'StudentForm',\n  props: {\n    updateId: {\n      type: String,\n      default: null,\n    },\n    visible: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    // Check Code\n    const validateCode = (rule, value, callback) => {\n      if (!value) {\n        return callback(new Error('Code is requiered'))\n      }\n      setTimeout(() => {\n        let selector = {\n          code: value,\n          branchId: this.currentBranchId,\n        }\n\n        if (this.updateId) {\n          selector._id = { $ne: this.updateId }\n        }\n\n        findOneStudent\n          .callPromise({ selector })\n          .then(result => {\n            if (result) {\n              callback(new Error('This code is existed'))\n            } else {\n              callback()\n            }\n          })\n          .catch(error => {\n            Notify.error({ message: error })\n          })\n      }, 1000)\n    }\n\n    return {\n      // loading\n      loading: {\n        form: false,\n        code: '',\n      },\n      // opts\n      genderOpts: lookupValue.gender,\n      typeOpts: lookupValue.type,\n      //form\n      form: {\n        registerDate: moment().toDate(),\n        code: '',\n        type: '',\n        khName: '',\n        enName: '',\n        gender: '',\n        dob: '',\n        tel: '',\n        remove: false,\n      },\n      // rules\n      rules: {\n        registerDate: [\n          { required: true, message: 'Date is required', trigger: 'change' },\n        ],\n        code: [{ validator: validateCode, required: true, trigger: 'change' }],\n        khName: [\n          {\n            required: true,\n            message: 'Please Input Khmrt Name',\n            trigger: 'blur',\n          },\n        ],\n        enName: [\n          {\n            required: true,\n            message: 'Please Input English Name',\n            trigger: 'blur',\n          },\n        ],\n        gender: [\n          { required: true, message: 'Please Select Gender', trigger: 'blur' },\n        ],\n        type: [\n          { required: true, message: 'Please Select Type', trigger: 'blur' },\n        ],\n        dob: [\n          {\n            required: true,\n            message: 'Date of birth is required!',\n            trigger: 'blur',\n          },\n        ],\n      },\n    }\n  },\n  computed: {\n    ...mapState({\n      currentBranchId(state) {\n        return state.app && state.app.currentBranch._id\n      },\n    }),\n    dateFormat() {\n      return this.$store.getters['app/dateFormat']\n    },\n  },\n  created() {\n    if (!this.updateId) this._getNextRefNum()\n  },\n  mounted() {\n    if (this.updateId) this._getOneStudentData()\n  },\n  methods: {\n    _getNextRefNum() {\n      this.loading.code = 'Loading....'\n      // getNextRef\n      getNextRef\n        .callPromise({\n          collectionName: 'sch_students',\n          opts: {\n            field: 'code',\n            selector: { branchId: this.currentBranchId },\n            paddingType: 'start',\n            paddingLength: 5,\n            paddingChar: '0',\n            // prefix: {},\n          },\n        })\n        .then(result => {\n          if (result) {\n            this.loading.code = ''\n            this.form.code = result\n          }\n        })\n        .catch(error => {\n          this.loading.code = ''\n          Notify.error({ message: error })\n        })\n    },\n    // Get data for update\n    _getOneStudentData() {\n      this.loading.form = true\n      findOneStudent\n        .callPromise({\n          selector: { _id: this.updateId, branchId: this.currentBranchId },\n        })\n        .then(result => {\n          this.form = result\n          this.loading.form = false\n        })\n        .catch(error => {\n          this.loading.form = false\n          Notify.error({ message: error })\n        })\n    },\n    /**\n     * Submit form\n     */\n    _submitForm() {\n      this.loading.form = true\n      this.$refs['form'].validate(valid => {\n        if (valid) {\n          this.form.dob = wrapCurrentTime(this.form.dob)\n          this.form.registerDate = wrapCurrentTime(this.form.registerDate)\n          this.form.branchId = this.currentBranchId\n          // console.log(this.form)\n          if (this.updateId) {\n            // Update data\n            updateStudent\n              .callPromise({ doc: this.form })\n              .then(result => {\n                if (result) {\n                  this.loading.form = false\n                  this.handleClose()\n                  Msg.success()\n                }\n              })\n              .catch(error => {\n                this.loading.form = false\n                Notify.error({ message: error })\n              })\n          } else {\n            // Insert data\n            insertStudent\n              .callPromise({ doc: this.form })\n              .then(result => {\n                if (result) {\n                  this.loading.form = false\n                  this.handelresetForm()\n                  Msg.success()\n                }\n              })\n              .catch(error => {\n                this.loading.form = false\n                Notify.error({ message: error })\n              })\n          }\n        } else {\n          this.loading.form = false\n          return false\n        }\n      })\n    },\n\n    handleClose() {\n      this.$emit('modal-close')\n    },\n    handelresetForm() {\n      this.$refs['form'].resetFields()\n    },\n  },\n}\n"]},"sourceType":"script","hash":"1c1a7cdcca555c911ed6a9b47b11e689324e9c39"}
