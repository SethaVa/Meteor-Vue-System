{"metadata":{},"options":{"plugins":[{"key":"/home/vy/Desktop/B.A.D/bad-system/node_modules/babel-plugin-transform-vue-jsx/index.js","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/vy/Desktop/B.A.D/bad-system/imports/modules/school/client/pages/ExchangeClassUpdate.vue","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","jsx","dynamicImport",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"/home/vy/Desktop/B.A.D/bad-system/imports/modules/school/client/pages/ExchangeClassUpdate.vue","filename":"/home/vy/Desktop/B.A.D/bad-system/imports/modules/school/client/pages/ExchangeClassUpdate.vue","passPerPreset":false,"envName":"development","cwd":"/home/vy/Desktop/B.A.D/bad-system","root":"/home/vy/Desktop/B.A.D/bad-system","generatorOpts":{"filename":"/home/vy/Desktop/B.A.D/bad-system/imports/modules/school/client/pages/ExchangeClassUpdate.vue","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"/home/vy/Desktop/B.A.D/bad-system/imports/modules/school/client/pages/ExchangeClassUpdate.vue"}},"code":"var Notify;\nmodule.link(\"/imports/client/lib/notify\", {\n  \"default\": function (v) {\n    Notify = v;\n  }\n}, 0);\nvar MsgBox;\nmodule.link(\"/imports/client/lib/message\", {\n  \"default\": function (v) {\n    MsgBox = v;\n  }\n}, 1);\nvar moment;\nmodule.link(\"moment\", {\n  \"default\": function (v) {\n    moment = v;\n  }\n}, 2);\nvar Lookup;\nmodule.link(\"/imports/client/lib/Lookup-Value\", {\n  \"default\": function (v) {\n    Lookup = v;\n  }\n}, 3);\nvar lookupClass;\nmodule.link(\"../../util/lookup-methods\", {\n  lookupClass: function (v) {\n    lookupClass = v;\n  }\n}, 4);\nvar findClassForStudenDetails;\nmodule.link(\"/imports/modules/school/api/payment/methods\", {\n  findClassForStudenDetails: function (v) {\n    findClassForStudenDetails = v;\n  }\n}, 5);\nvar findOnePayment;\nmodule.link(\"/imports/modules/school/api/payment/methods\", {\n  findOnePayment: function (v) {\n    findOnePayment = v;\n  }\n}, 6);\nvar updateExchangeClass, findOneExchangeClass;\nmodule.link(\"/imports/modules/school/api/exchange-class/methods\", {\n  updateExchangeClass: function (v) {\n    updateExchangeClass = v;\n  },\n  findOneExchangeClass: function (v) {\n    findOneExchangeClass = v;\n  }\n}, 7);\nvar findOneClassStudy;\nmodule.link(\"/imports/modules/school/api/class-study/methods\", {\n  findOneClassStudy: function (v) {\n    findOneClassStudy = v;\n  }\n}, 8);\nmodule.exportDefault({\n  props: {\n    visible: {\n      type: Boolean,\n      \"default\": false\n    },\n    updateId: {\n      type: String,\n      \"default\": null\n    }\n  },\n  data: function () {\n    return {\n      classFromIdOpts: [],\n      classToIdOpts: [],\n      typeOpts: Lookup.type,\n      studentOpts: [],\n      type: '',\n      tmpClassDoc: {},\n      fee: 0,\n      payDate: '',\n      duration: 0,\n      endPayDate: '',\n      totalPay: 0,\n      usd: 0,\n      khr: 0,\n      classId: '',\n      form: {},\n      // form: {\n      //   typeTo: '',\n      //   tranDate: moment().toDate(),\n      //   studentId: '',\n      //   classFromId: '',\n      //   classToId: '',\n      // },\n      rules: {\n        tranDate: [{\n          required: true\n        }],\n        type: [{\n          required: true\n        }],\n        classFromId: [{\n          required: true\n        }],\n        studentId: [{\n          required: true\n        }],\n        classToId: [{\n          required: true\n        }]\n      }\n    };\n  },\n  watch: {\n    'form.type': function (val) {\n      this.handleTypeChange(val);\n    },\n    'form.classFromId': function (val) {\n      this.handleClassFromChagne(val);\n    },\n    'form.studentId': function (val) {\n      this.handleStudentChange(val);\n    }\n  },\n  mounted: function () {\n    this.getDataUpdate(); // this.getStudentLastExChange()\n  },\n  methods: {\n    getDataUpdate: function () {\n      var _this = this;\n\n      this.loading = true;\n      findOneExchangeClass.callPromise({\n        id: {\n          _id: this.updateId\n        }\n      }).then(function (result) {\n        if (result) {\n          // console.log(result)\n          _this.form = result;\n          _this.classId = result.classFromId;\n        }\n\n        _this.loading = false;\n      }).catch(function (error) {\n        Notify.error({\n          message: error\n        });\n      });\n    },\n    handleTypeChange: function (val) {\n      var _this2 = this;\n\n      if (val) {\n        this.type = val; // this.form.classFromId = ''\n        // this.form.classToId = ''\n        // this.form.studentId = ''\n        // this.classFromIdOpts = []\n        // this.classToIdOpts = []\n        // this.studentOpts = []\n\n        var selector = {\n          type: val,\n          status: {\n            $ne: 'Closed'\n          }\n        };\n        lookupClass.callPromise({\n          selector: selector\n        }).then(function (result) {\n          _this2.classFromIdOpts = result;\n        }).catch(function (error) {\n          Notify.error({\n            message: error\n          });\n        });\n      } else {\n        this.classFromIdOpts = [];\n        this.classToIdOpts = [];\n        this.studentOpts = [];\n        this.form.classFromId = '';\n        this.form.classToId = '';\n        this.form.studentId = '';\n      }\n    },\n    handleClassFromChagne: function (val) {\n      var _this3 = this;\n\n      if (val) {\n        // this.classToIdOpts = []\n        // this.studentOpts = []\n        var selector = {\n          // type: this.type,\n          _id: {\n            $ne: val\n          }\n        };\n        lookupClass.callPromise({\n          selector: selector\n        }).then(function (result) {\n          if (result) {\n            _this3.classToIdOpts = result;\n          } else {\n            _this3.classToIdOpts = [];\n          }\n        }).catch(function (error) {\n          Notify.error({\n            message: error\n          });\n        }); //Get Student\n\n        var classSelector = {\n          classId: val,\n          status: {\n            $ne: 'Closed'\n          }\n        };\n        findClassForStudenDetails.callPromise({\n          selector: classSelector\n        }).then(function (result) {\n          if (result.length > 0) {\n            _this3.studentOpts = result[0].classDetail;\n          } else {\n            _this3.studentOpts = [];\n          }\n        }).catch(function (error) {\n          Notify.error({\n            message: error.reason\n          });\n        });\n      } else {\n        this.classToIdOpts = [];\n        this.studentOpts = [];\n        this.form.classToId = '';\n        this.form.studentId = '';\n      }\n    },\n    getStudentLastExChange: function () {\n      var _this4 = this;\n\n      var classSelector = {\n        classId: this.classId // status: { $ne: 'Closed' }\n        // let option = {\n        //   $sort: { _id: -1 },\n        // }\n\n      };\n      findClassForStudenDetails.callPromise({\n        selector: classSelector\n      }).then(function (result) {\n        if (result) {\n          _this4.studentOpts = result[0].classDetail;\n        } else {\n          _this4.studentOpts = [];\n        }\n      }).catch(function (error) {\n        Notify.error({\n          message: error.reason\n        });\n      });\n    },\n    handleStudentChange: function (val) {\n      var _this5 = this;\n\n      var selector = {\n        studentId: val,\n        $and: [{\n          status: {\n            $ne: 'Closed'\n          }\n        }, {\n          status: {\n            $ne: 'Expires'\n          }\n        }]\n      };\n      findOnePayment.callPromise({\n        _id: selector\n      }).then(function (result) {\n        if (result) {\n          _this5.fee = result.fee;\n          _this5.payDate = result.payDate;\n          _this5.duration = result.duration;\n          _this5.endPayDate = result.endPayDate;\n          _this5.totalPay = result.totalPay;\n          _this5.usd = result.usd;\n          _this5.khr = result.khr;\n          _this5.tmpClassDoc = result;\n        }\n      }).catch(function (error) {\n        Notify.error({\n          message: error\n        });\n      });\n    },\n    handleClassToChange: function (val) {\n      var _this6 = this;\n\n      if (val) {\n        findOneClassStudy.callPromise({\n          id: val\n        }).then(function (result) {\n          _this6.form.typeTo = result.type;\n        }).catch(function (error) {\n          Notify.error({\n            message: error\n          });\n        });\n      }\n    },\n    handleSave: function () {\n      var _this7 = this;\n\n      this.$refs['form'].validate(function (valid) {\n        if (valid) {\n          updateExchangeClass.callPromise({\n            doc: _this7.form,\n            details: _this7.tmpClassDoc\n          }).then(function (result) {\n            if (result) {\n              MsgBox.success();\n\n              _this7.handleClose();\n            }\n          }).catch(function (err) {\n            Notify.error({\n              message: err.reason\n            });\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    handleClose: function () {\n      this.$emit('modal-close');\n    },\n    handleresetForm: function () {\n      this.$refs['form'].resetFields();\n    },\n    formatDate: function (val) {\n      return moment(val).format('DD/MM/YYYY');\n    }\n  }\n});","map":{"version":3,"sources":["/home/vy/Desktop/B.A.D/bad-system/imports/modules/school/client/pages/ExchangeClassUpdate.vue"],"names":["Notify","module","link","v","MsgBox","moment","Lookup","lookupClass","findClassForStudenDetails","findOnePayment","updateExchangeClass","findOneExchangeClass","findOneClassStudy","exportDefault","props","visible","type","Boolean","updateId","String","data","classFromIdOpts","classToIdOpts","typeOpts","studentOpts","tmpClassDoc","fee","payDate","duration","endPayDate","totalPay","usd","khr","classId","form","rules","tranDate","required","classFromId","studentId","classToId","watch","val","handleTypeChange","handleClassFromChagne","handleStudentChange","mounted","getDataUpdate","methods","loading","callPromise","id","_id","then","result","catch","error","message","selector","status","$ne","classSelector","length","classDetail","reason","getStudentLastExChange","$and","handleClassToChange","typeTo","handleSave","$refs","validate","valid","doc","details","success","handleClose","err","$emit","handleresetForm","resetFields","formatDate","format"],"mappings":"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","sourcesContent":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Notify from '/imports/client/lib/notify'\nimport MsgBox from '/imports/client/lib/message'\nimport moment from 'moment'\nimport Lookup from '/imports/client/lib/Lookup-Value'\n//\nimport { lookupClass } from '../../util/lookup-methods'\nimport { findClassForStudenDetails } from '/imports/modules/school/api/payment/methods'\nimport { findOnePayment } from '/imports/modules/school/api/payment/methods'\nimport {\n  updateExchangeClass,\n  findOneExchangeClass,\n} from '/imports/modules/school/api/exchange-class/methods'\nimport { findOneClassStudy } from '/imports/modules/school/api/class-study/methods'\n\nexport default {\n  props: {\n    visible: {\n      type: Boolean,\n      default: false,\n    },\n    updateId: {\n      type: String,\n      default: null,\n    },\n  },\n  data() {\n    return {\n      classFromIdOpts: [],\n      classToIdOpts: [],\n      typeOpts: Lookup.type,\n      studentOpts: [],\n      type: '',\n\n      tmpClassDoc: {},\n      fee: 0,\n      payDate: '',\n      duration: 0,\n      endPayDate: '',\n      totalPay: 0,\n      usd: 0,\n      khr: 0,\n      classId: '',\n      form: {},\n      // form: {\n      //   typeTo: '',\n      //   tranDate: moment().toDate(),\n      //   studentId: '',\n      //   classFromId: '',\n      //   classToId: '',\n      // },\n      rules: {\n        tranDate: [{ required: true }],\n        type: [{ required: true }],\n        classFromId: [{ required: true }],\n        studentId: [{ required: true }],\n        classToId: [{ required: true }],\n      },\n    }\n  },\n  watch: {\n    'form.type'(val) {\n      this.handleTypeChange(val)\n    },\n    'form.classFromId'(val) {\n      this.handleClassFromChagne(val)\n    },\n    'form.studentId'(val) {\n      this.handleStudentChange(val)\n    },\n  },\n  mounted() {\n    this.getDataUpdate()\n    // this.getStudentLastExChange()\n  },\n  methods: {\n    getDataUpdate() {\n      this.loading = true\n      findOneExchangeClass\n        .callPromise({ id: { _id: this.updateId } })\n        .then(result => {\n          if (result) {\n            // console.log(result)\n            this.form = result\n            this.classId = result.classFromId\n          }\n          this.loading = false\n        })\n        .catch(error => {\n          Notify.error({ message: error })\n        })\n    },\n    handleTypeChange(val) {\n      if (val) {\n        this.type = val\n        // this.form.classFromId = ''\n        // this.form.classToId = ''\n        // this.form.studentId = ''\n\n        // this.classFromIdOpts = []\n        // this.classToIdOpts = []\n        // this.studentOpts = []\n        let selector = {\n          type: val,\n          status: { $ne: 'Closed' },\n        }\n        lookupClass\n          .callPromise({ selector })\n          .then(result => {\n            this.classFromIdOpts = result\n          })\n          .catch(error => {\n            Notify.error({ message: error })\n          })\n      } else {\n        this.classFromIdOpts = []\n        this.classToIdOpts = []\n        this.studentOpts = []\n        this.form.classFromId = ''\n        this.form.classToId = ''\n        this.form.studentId = ''\n      }\n    },\n    handleClassFromChagne(val) {\n      if (val) {\n        // this.classToIdOpts = []\n        // this.studentOpts = []\n        let selector = {\n          // type: this.type,\n          _id: { $ne: val },\n        }\n        lookupClass\n          .callPromise({ selector })\n          .then(result => {\n            if (result) {\n              this.classToIdOpts = result\n            } else {\n              this.classToIdOpts = []\n            }\n          })\n          .catch(error => {\n            Notify.error({ message: error })\n          })\n        //Get Student\n        let classSelector = {\n          classId: val,\n          status: { $ne: 'Closed' },\n        }\n        findClassForStudenDetails\n          .callPromise({ selector: classSelector })\n          .then(result => {\n            if (result.length>0) {\n              this.studentOpts = result[0].classDetail\n            } else {\n              this.studentOpts = []\n            }\n          })\n          .catch(error => {\n            Notify.error({ message: error.reason })\n          })\n      } else {\n        this.classToIdOpts = []\n        this.studentOpts = []\n        this.form.classToId = ''\n        this.form.studentId = ''\n      }\n    },\n    getStudentLastExChange() {\n      let classSelector = {\n        classId: this.classId,\n        // status: { $ne: 'Closed' }\n      }\n      // let option = {\n      //   $sort: { _id: -1 },\n      // }\n      findClassForStudenDetails\n        .callPromise({ selector: classSelector })\n        .then(result => {\n          if (result) {\n            this.studentOpts = result[0].classDetail\n          } else {\n            this.studentOpts = []\n          }\n        })\n        .catch(error => {\n          Notify.error({ message: error.reason })\n        })\n    },\n    handleStudentChange(val) {\n      let selector = {\n        studentId: val,\n        $and: [{ status: { $ne: 'Closed' } }, { status: { $ne: 'Expires' } }],\n      }\n\n      findOnePayment\n        .callPromise({ _id: selector })\n        .then(result => {\n          if (result) {\n            this.fee = result.fee\n            this.payDate = result.payDate\n            this.duration = result.duration\n            this.endPayDate = result.endPayDate\n            this.totalPay = result.totalPay\n            this.usd = result.usd\n            this.khr = result.khr\n\n            this.tmpClassDoc = result\n          }\n        })\n        .catch(error => {\n          Notify.error({ message: error })\n        })\n    },\n    handleClassToChange(val) {\n      if (val) {\n        findOneClassStudy\n          .callPromise({ id: val })\n          .then(result => {\n            this.form.typeTo = result.type\n          })\n          .catch(error => {\n            Notify.error({ message: error })\n          })\n      }\n    },\n    handleSave() {\n      this.$refs['form'].validate(valid => {\n        if (valid) {\n          updateExchangeClass\n            .callPromise({ doc: this.form, details: this.tmpClassDoc })\n            .then(result => {\n              if (result) {\n                MsgBox.success()\n                this.handleClose()\n              }\n            })\n            .catch(err => {\n              Notify.error({ message: err.reason })\n            })\n        } else {\n          return false\n        }\n      })\n    },\n    handleClose() {\n      this.$emit('modal-close')\n    },\n    handleresetForm() {\n      this.$refs['form'].resetFields()\n    },\n    formatDate(val) {\n      return moment(val).format('DD/MM/YYYY')\n    },\n  },\n}\n"]},"sourceType":"script","hash":"3d306b9f64e75be8d881df0916c1afcc3a699cc1"}
